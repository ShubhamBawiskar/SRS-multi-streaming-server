<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated RTMP Streaming with SRS & FFmpeg</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- UI/UX Redesign: "Neon Terminal" Theme --- */
        
        /* Base styling with a dark navy background */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a192f; /* Dark Navy */
            color: #8892b0; /* Slate */
        }

        /* Main container with a subtle glow */
        .main-container {
            background: rgba(17, 34, 64, 0.75); /* Transparent Navy */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid #1e2a47; /* Darker Navy/Slate */
            border-radius: 1rem;
            box-shadow: 0 10px 30px -15px rgba(2, 12, 27, 0.7);
        }

        /* Tab styling with a sharp cyan underline */
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            color: #ccd6f6; /* Light Slate */
            padding-bottom: 0.75rem;
        }
        .tab-button.active {
            color: #64ffda; /* Neon Cyan */
            border-bottom-color: #64ffda;
        }
        .tab-button:not(.active):hover {
            color: #64ffda;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Accordion styling */
        .accordion-item {
             background-color: #112240; /* Light Navy */
             border: 1px solid #1e2a47;
             transition: background-color 0.3s ease;
        }
        .accordion-item:hover {
            background-color: #172a45;
        }
        .accordion-header {
            cursor: pointer;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
        }
        .accordion-item.open .accordion-content {
            max-height: 1500px;
            padding-top: 1rem;
        }
        .accordion-item.open .accordion-arrow {
            transform: rotate(90deg);
            color: #64ffda; /* Neon Cyan */
        }
        .accordion-arrow {
            transition: all 0.3s ease;
        }

        /* Code block container */
        .code-block {
            position: relative;
            background-color: #020c1b; /* Almost Black */
            border: 1px solid #1e2a47;
        }
        
        /* Copy button styling */
        .copy-button {
            position: absolute; top: 0.75rem; right: 0.75rem;
            background-color: #112240; color: #8892b0; border: 1px solid #1e2a47;
            padding: 0.5rem; border-radius: 0.375rem; cursor: pointer;
            transition: all 0.2s ease-in-out; display: flex; align-items: center; gap: 0.5rem;
        }
        .copy-button:hover { background-color: #1e2a47; color: #64ffda; }
        .copy-button .copy-icon, .copy-button .check-icon { width: 1rem; height: 1rem; }
        .copy-button .check-icon { display: none; color: #64ffda; }
        .copy-button.copied { color: #64ffda; border-color: #64ffda; }
        .copy-button.copied .copy-text { color: #64ffda; }
        .copy-button.copied .copy-icon { display: none; }
        .copy-button.copied .check-icon { display: block; }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-5xl">
        
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-slate-100">
                Automated RTMP Streaming Server
            </h1>
            <p class="mt-4 text-lg text-slate-400">A professional guide to using SRS and FFmpeg for dynamic video stream management.</p>
        </header>

        <div class="main-container p-6 sm:p-8">
            <!-- Tabs Navigation -->
            <div class="border-b border-slate-700 mb-8">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button class="tab-button active whitespace-nowrap py-4 px-1 text-base font-medium" data-tab="goal">Overview</button>
                    <button class="tab-button whitespace-nowrap py-4 px-1 text-base font-medium" data-tab="tools">Tools</button>
                    <button class="tab-button whitespace-nowrap py-4 px-1 text-base font-medium" data-tab="architecture">Architecture</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div>
                <div id="tab-goal" class="tab-content active">
                    <h2 class="text-2xl font-semibold flex items-center text-slate-200 mb-4">Project Goal</h2>
                    <ul class="list-disc list-inside space-y-2 text-slate-400">
                        <li>Accept multiple input sources (<strong class="text-slate-300">YouTube, RTSP, local files,</strong> etc.).</li>
                        <li>Restream them through SRS as dynamic <strong class="text-slate-300">RTMP endpoints</strong>.</li>
                        <li><strong class="text-slate-300">Automate</strong> the entire setup to avoid manual configuration per stream.</li>
                    </ul>
                </div>

                <div id="tab-tools" class="tab-content">
                    <h2 class="text-2xl font-semibold flex items-center text-slate-200 mb-4">Technology Stack</h2>
                    <ul class="list-disc list-inside space-y-2 text-slate-400">
                        <li><strong class="text-slate-300">SRS:</strong> The core RTMP server.</li>
                        <li><strong class="text-slate-300">FFmpeg:</strong> For ingesting and relaying streams.</li>
                        <li><strong class="text-slate-300">yt-dlp:</strong> A youtube-dl fork for fetching video from web sources.</li>
                        <li><strong class="text-slate-300">Python Script:</strong> To automate and manage processes.</li>
                        <li><strong class="text-slate-300">Docker:</strong> For easy SRS deployment.</li>
                    </ul>
                </div>

                <div id="tab-architecture" class="tab-content">
                     <h2 class="text-2xl font-semibold flex items-center text-slate-200 mb-4">System Architecture</h2>
                    <p class="mt-4 text-slate-400">The Python script acts as a manager, using FFmpeg and yt-dlp to pull video from various sources and push it to the SRS media server, which then makes the streams available to viewers.</p>
                    <div class="mt-6">
                        <h3 class="font-semibold text-lg mb-4 text-slate-300">Data Flow Diagram</h3>
                        <div class="flex flex-col md:flex-row items-center justify-between text-center text-sm p-4 bg-black/20 rounded-lg">
                            <div class="flex flex-col items-center"><div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><p class="font-bold text-white">Input Sources</p><p class="text-xs text-slate-400">YouTube, RTSP, Files</p></div></div>
                            <div class="text-slate-500 my-2 md:my-0 md:mx-4 text-2xl font-light text-cyan-400">→</div>
                            <div class="flex flex-col items-center"><div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><p class="font-bold text-white">Python + FFmpeg</p><p class="text-xs text-slate-400">Pulls & Pushes</p></div></div>
                            <div class="text-slate-500 my-2 md:my-0 md:mx-4 text-2xl font-light text-cyan-400">→</div>
                            <div class="flex flex-col items-center"><div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><p class="font-bold text-cyan-300">SRS Server</p><p class="text-xs text-cyan-400">Distributes</p></div></div>
                            <div class="text-slate-500 my-2 md:my-0 md:mx-4 text-2xl font-light text-cyan-400">→</div>
                            <div class="flex flex-col items-center"><div class="p-3 bg-slate-800 rounded-lg border border-slate-700"><p class="font-bold text-white">Viewers</p><p class="text-xs text-slate-400">VLC, Web Player</p></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step-by-Step Guide Accordion -->
            <div class="mt-12">
                <h2 class="text-3xl font-semibold mb-8 text-center text-slate-200">
                    Implementation Guide
                </h2>
                <div class="space-y-4">
                    <!-- Step 1 -->
                    <div class="accordion-item rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-5">
                            <h3 class="text-xl font-semibold text-slate-200"><span class="text-cyan-400">Step 1:</span> Install Prerequisites</h3>
                            <svg class="accordion-arrow w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </div>
                        <div class="accordion-content px-5 pb-5">
                            <p class="mb-4 text-slate-400">Ensure all required tools are installed on your system.</p>
                            <ul class="list-disc list-inside text-slate-400 space-y-1">
                                <li><a href="https://docs.docker.com/get-docker/" target="_blank" class="text-cyan-400 hover:underline">Install Docker</a></li>
                                <li><a href="https://ffmpeg.org/download.html" target="_blank" class="text-cyan-400 hover:underline">Install FFmpeg</a></li>
                                <li><a href="https://github.com/yt-dlp/yt-dlp" target="_blank" class="text-cyan-400 hover:underline">Install yt-dlp</a> (for YouTube/web sources)</li>
                            </ul>
                        </div>
                    </div>
                    <!-- Step 2 -->
                    <div class="accordion-item rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-5">
                            <h3 class="text-xl font-semibold text-slate-200"><span class="text-cyan-400">Step 2:</span> Launch the SRS Media Server</h3>
                            <svg class="accordion-arrow w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </div>
                        <div class="accordion-content px-5 pb-5">
                           <p class="mb-4 text-slate-400">Use Docker to start SRS, mapping the necessary ports.</p>
                            <div class="code-block rounded-md p-4 mt-2">
                                <button class="copy-button" onclick="copyCode(this)"><span class="copy-text">Copy</span><svg class="copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button>
                                <pre><code class="language-bash">docker run --rm -it -p 1935:1935 -p 8080:8080 -p 1985:1985 -p 8000:8000/udp -v "%cd%":/usr/local/srs/conf ossrs/srs:5 ./objs/srs -c conf/srs.conf</code></pre>
                            </div>
                        </div>
                    </div>
                    <!-- Step 3 -->
                    <div class="accordion-item rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-5">
                            <h3 class="text-xl font-semibold text-slate-200"><span class="text-cyan-400">Step 3:</span> Configure and Run the Python Script</h3>
                            <svg class="accordion-arrow w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </div>
                        <div class="accordion-content px-5 pb-5">
                            <p class="mb-4 text-slate-400">Save the script below as `start_streams.py`. Modify the `streams` dictionary with your sources.</p>
                            <div class="code-block rounded-md p-4 mt-2">
                                <button class="copy-button" onclick="copyCode(this)"><span class="copy-text">Copy</span><svg class="copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button>
                                <pre><code class="language-python">import subprocess
import time

# Define your input sources and output keys
streams = {
    "cam1": "https://www.youtube.com/watch?v=jfKfPfyJRdk", # Live YouTube Stream
    "cam2": "rtsp://192.168.1.11/stream2",                # RTSP Camera
    "video1": "video1.mp4"                               # Local file
}

def start_stream(name, source):
    output = f"rtmp://localhost/live/{name}"
    shell = False
    
    if "youtube.com" in source or "youtu.be" in source:
        # For YouTube: use yt-dlp to pipe video to ffmpeg
        command = (
            f'yt-dlp -f best -o - "{source}" | '
            f'ffmpeg -re -i - -c:v copy -c:a aac -ar 44100 -f flv "{output}"'
        )
        shell = True # Popen needs shell=True to handle pipes
    else:
        # For regular sources (RTSP, files)
        command = [
            "ffmpeg", "-re", "-i", source,
            "-c:v", "copy", "-c:a", "aac", # Safer audio fallback
            "-f", "flv", output
        ]

    print(f"🚀 Starting stream '{name}'...")
    return subprocess.Popen(command, shell=shell)

processes = []
for name, src in streams.items():
    proc = start_stream(name, src)
    processes.append(proc)
    time.sleep(2) # Optional delay

print("\n✅ All stream processes initiated.")
try:
    for p in processes:
        p.wait()
except KeyboardInterrupt:
    print("\n🛑 Terminating all FFmpeg processes...")
    for p in processes:
        p.terminate()
</code></pre>
                            </div>
                            <p class="mt-4 text-slate-400">Run the script from your terminal:</p>
                            <div class="code-block rounded-md p-4 mt-2">
                                <pre><code class="language-bash">python start_streams.py</code></pre>
                            </div>
                        </div>
                    </div>
                    <!-- Step 4 -->
                     <div class="accordion-item rounded-lg">
                        <div class="accordion-header flex justify-between items-center p-5">
                            <h3 class="text-xl font-semibold text-slate-200"><span class="text-cyan-400">Step 4:</span> Access and View the Streams</h3>
                            <svg class="accordion-arrow w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </div>
                        <div class="accordion-content px-5 pb-5">
                            <p class="text-slate-400">Use an RTMP-compatible player to view your live streams. Replace `<your-server-ip>` with the IP address of the machine running Docker.</p>
                            <div class="mt-4 space-y-2">
                                <p><code class="bg-slate-700/50 text-cyan-300 p-1 rounded">rtmp://&lt;your-server-ip&gt;/live/cam1</code></p>
                                <p><code class="bg-slate-700/50 text-cyan-300 p-1 rounded">rtmp://&lt;your-server-ip&gt;/live/cam2</code></p>
                            </div>
                            <p class="mt-4 text-slate-400">You can preview them in:</p>
                            <ul class="list-disc list-inside mt-2 text-slate-300">
                                <li><strong>VLC Media Player:</strong> Go to <code class="bg-slate-700/50 text-cyan-300 p-1 rounded">Media &gt; Open Network Stream...</code></li>
                                <li><strong>Web Player:</strong> Use a player like video.js or Clappr to embed the stream.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById('tab-' + button.dataset.tab).classList.add('active');
            });
        });

        const accordionItems = document.querySelectorAll('.accordion-item');
        accordionItems.forEach(item => {
            const header = item.querySelector('.accordion-header');
            header.addEventListener('click', () => {
                item.classList.toggle('open');
            });
        });

        function copyCode(button) {
            const codeBlock = button.parentElement.querySelector('pre');
            const code = codeBlock.innerText;
            const copyText = button.querySelector('.copy-text');
            navigator.clipboard.writeText(code).then(() => {
                button.classList.add('copied');
                if (copyText) copyText.textContent = 'Copied!';
                setTimeout(() => {
                    button.classList.remove('copied');
                    if (copyText) copyText.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                if (copyText) copyText.textContent = 'Failed!';
            });
        }
    </script>

</body>
</html>
